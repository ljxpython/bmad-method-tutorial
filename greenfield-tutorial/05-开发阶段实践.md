# 第五部分：开发阶段实践

## 🎯 本章目标

学完本章后，你将：
- 💻 在IDE中熟练使用BMAD开发代理
- 📝 掌握故事驱动的开发模式
- 🔄 体验SM→Developer→QA的完整循环
- ✅ 构建出完整的TodoMaster应用

## ⚠️ 重要准备

**开始前确保**：
- ✅ 已完成第四章的规划阶段
- ✅ 拥有完整的PRD和架构文档
- ✅ 已安装支持AI的IDE（VS Code + Claude Code/Cursor等）
- ✅ 项目环境已正确配置

## 🔄 第一步：从Web UI转换到IDE

### 关键转换点
现在我们要从Web UI的规划阶段切换到IDE的开发阶段。

### 确保文档在项目中
检查你的项目目录：
```bash
cd my-todo-app

# 确认文档结构
ls -la docs/
# 应该看到：
# analysis/market-research.md
# planning/prd.md  
# architecture/system-design.md
```

如果文档不在项目中，请复制过来：
```bash
# 创建标准文档文件
touch docs/prd.md
touch docs/architecture.md

# 将Web UI中的内容复制到这些文件中
```

### 打开IDE
在你的项目目录中打开IDE：
```bash
# VS Code用户
code .

# Cursor用户  
cursor .

# 其他IDE用户，按相应方式打开项目
```

## 📄 第二步：文档分片（Document Sharding）

大型文档需要分片处理，便于代理理解和操作。

### 识别你的IDE代理命令格式
不同IDE有不同的代理调用方式：

**VS Code + Claude Code**：
```bash
# 使用斜杠命令
/po 请帮我分片PRD文档
```

**Cursor**：
```bash
# 使用@符号
@po 请帮我分片PRD文档
```

**其他IDE**：根据具体配置，可能是其他格式

### 分片PRD文档
在IDE中加载Product Owner代理并分片文档：

```bash
# 调用PO代理（根据你的IDE调整命令格式）
@po 请帮我分片docs/prd.md文档，将其分解为更小的、易于管理的文档片段。

请创建以下分片：
1. product-overview.md - 产品概述
2. user-stories.md - 用户故事  
3. functional-requirements.md - 功能需求
4. non-functional-requirements.md - 非功能需求
5. project-timeline.md - 项目时间线
```

### 分片架构文档
```bash
@po 请帮我分片docs/architecture.md文档。

请创建以下分片：
1. tech-stack.md - 技术栈选择
2. database-design.md - 数据库设计
3. api-specification.md - API规范
4. frontend-architecture.md - 前端架构
5. security-design.md - 安全设计
```

### 验证分片结果
分片完成后，你的docs目录应该类似：
```
docs/
├── analysis/
│   └── market-research.md
├── planning/
│   ├── product-overview.md
│   ├── user-stories.md
│   ├── functional-requirements.md
│   ├── non-functional-requirements.md
│   └── project-timeline.md
├── architecture/
│   ├── tech-stack.md
│   ├── database-design.md
│   ├── api-specification.md
│   ├── frontend-architecture.md
│   └── security-design.md
├── prd.md (原始文件)
└── architecture.md (原始文件)
```

## 📝 第三步：Scrum Master - 创建第一个故事

### 启动新的IDE对话
在IDE中开始新的对话会话。

### 加载Scrum Master代理
```bash
# 根据你的IDE调整命令
@sm

# 或使用任务命令
*draft
```

### 请求创建故事
```bash
基于我们项目的PRD和架构文档，请为TodoMaster项目创建第一个开发故事。

项目背景：
- 这是一个待办事项管理应用
- 已完成需求分析和架构设计
- 准备开始MVP开发

请分析所有规划文档，然后创建第一个应该实现的开发故事。
```

### SM的工作流程
Scrum Master会：

1. **分析项目文档**
   - 读取PRD了解功能需求
   - 检查架构文档了解技术方案
   - 理解项目的优先级

2. **确定故事优先级**
   - 识别依赖关系
   - 考虑技术复杂度
   - 评估业务价值

3. **创建详细故事**
   - 编写故事描述
   - 定义验收标准
   - 提供技术指导
   - 列出相关文件

### 期望的第一个故事
SM通常会创建类似这样的故事：

```markdown
# Story 1: 项目基础架构搭建

## 故事描述
作为开发者，我需要搭建项目的基础架构，包括前端和后端的基本结构，为后续功能开发做准备。

## 验收标准
- [ ] 创建Express.js后端服务器基础结构
- [ ] 配置基本的路由和中间件
- [ ] 创建React前端应用基础结构
- [ ] 配置前后端开发环境
- [ ] 实现基本的健康检查端点
- [ ] 确保前后端可以正常通信

## 技术实现指导
- 使用Express.js创建后端API服务
- 使用Create React App或Vite创建前端应用
- 配置CORS以支持跨域请求
- 设置开发环境的热重载

## 文件清单
- server/app.js - Express服务器主文件
- server/routes/index.js - 基础路由
- client/src/App.js - React主组件
- client/src/components/ - 组件目录
- package.json - 项目依赖

## 依赖关系
- 无前置依赖
- 为所有后续故事提供基础架构
```

## 💻 第四步：Developer - 实现第一个故事

### 切换到Developer代理
```bash
@dev

# 或使用任务命令
*develop-story story-1-project-setup.md
```

### 请求实现故事
```bash
请实现刚才SM创建的第一个故事：项目基础架构搭建。

基于我们的架构文档，请：
1. 创建完整的项目结构
2. 实现所有验收标准
3. 确保代码质量和最佳实践
4. 添加必要的注释和文档

请逐步实现，并解释每个步骤的目的。
```

### Developer的工作流程

Developer会按照以下步骤实现：

#### 1. 项目结构创建
```bash
# Developer会创建类似这样的结构
mkdir -p server/{routes,models,middleware,config}
mkdir -p client/src/{components,pages,hooks,utils,styles}
```

#### 2. 后端基础实现
**server/package.json**:
```json
{
  "name": "todomaster-server",
  "version": "1.0.0",
  "main": "app.js",
  "scripts": {
    "start": "node app.js",
    "dev": "nodemon app.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "dotenv": "^16.0.3"
  },
  "devDependencies": {
    "nodemon": "^2.0.22"
  }
}
```

**server/app.js**:
```javascript
const express = require('express');
const cors = require('cors');
require('dotenv').config();

const app = express();
const PORT = process.env.PORT || 5000;

// 中间件
app.use(cors());
app.use(express.json());

// 基础路由
app.get('/api/health', (req, res) => {
  res.json({ 
    status: 'OK', 
    message: 'TodoMaster API is running',
    timestamp: new Date().toISOString()
  });
});

// 启动服务器
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});

module.exports = app;
```

#### 3. 前端基础实现
**client/package.json**:
```json
{
  "name": "todomaster-client",
  "version": "1.0.0",
  "private": true,
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "axios": "^1.4.0"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "devDependencies": {
    "react-scripts": "5.0.1"
  }
}
```

**client/src/App.js**:
```javascript
import React, { useState, useEffect } from 'react';
import './App.css';

function App() {
  const [apiStatus, setApiStatus] = useState('Checking...');

  useEffect(() => {
    // 测试API连接
    fetch('http://localhost:5000/api/health')
      .then(response => response.json())
      .then(data => {
        setApiStatus(`✅ ${data.message}`);
      })
      .catch(error => {
        setApiStatus('❌ API connection failed');
        console.error('API Error:', error);
      });
  }, []);

  return (
    <div className="App">
      <header className="App-header">
        <h1>TodoMaster</h1>
        <p>智能待办事项管理器</p>
        <div className="api-status">
          API Status: {apiStatus}
        </div>
      </header>
    </div>
  );
}

export default App;
```

#### 4. 开发环境配置
Developer还会提供运行指导：

```bash
# 启动后端服务器
cd server
npm install
npm run dev

# 新终端启动前端
cd client  
npm install
npm start
```

## 🧪 第五步：QA - 质量检查

### 启动QA代理
```bash
@qa

# 或使用任务命令
*review story-1-project-setup.md
```

### 请求质量检查
```bash
请对刚才实现的第一个故事进行全面的质量检查。

检查重点：
1. 所有验收标准是否满足
2. 代码质量和最佳实践
3. 项目结构是否合理
4. 是否有潜在的问题或改进空间

请提供详细的检查报告和改进建议。
```

### QA的检查流程

#### 1. 功能验证
QA会检查：
- ✅ Express服务器能否正常启动
- ✅ React前端能否正常运行
- ✅ 前后端能否正常通信
- ✅ 健康检查端点是否工作

#### 2. 代码质量检查
```markdown
## QA检查报告

### ✅ 功能验证
- [x] 后端服务器启动成功
- [x] 前端应用运行正常
- [x] API健康检查端点工作
- [x] 前后端通信正常

### 📋 代码质量
- 代码结构清晰，符合最佳实践
- 错误处理需要加强
- 缺少日志记录
- 环境变量配置正确

### ⚠️ 发现的问题
1. 缺少环境变量验证
2. 没有错误处理中间件
3. 前端缺少loading状态处理
4. 缺少基本的安全头设置

### 💡 改进建议
1. 添加环境变量验证
2. 实现全局错误处理
3. 加强前端错误边界
4. 添加基本安全中间件
```

#### 3. 安全检查
QA还会检查安全相关问题：
- CORS配置是否合适
- 是否有基本的安全头
- 环境变量是否正确处理

### 根据QA反馈改进
如果QA发现问题，返回Developer进行修复：

```bash
@dev

基于QA的反馈，请修复以下问题：
1. 添加环境变量验证
2. 实现全局错误处理中间件
3. 加强前端错误处理
4. 添加基本安全中间件

请更新相应的代码。
```

## 🔄 第六步：完成第一个故事并开始循环

### 标记故事完成
当QA检查通过后，在故事文件中更新状态：

```markdown
# Story 1: 项目基础架构搭建

**状态**: ✅ 已完成
**完成日期**: 2024-XX-XX
**开发时间**: X小时

## 验收标准 ✅
- [x] 创建Express.js后端服务器基础结构
- [x] 配置基本的路由和中间件
- [x] 创建React前端应用基础结构
- [x] 配置前后端开发环境
- [x] 实现基本的健康检查端点
- [x] 确保前后端可以正常通信

## QA检查结果 ✅
- 所有功能测试通过
- 代码质量符合标准
- 安全检查通过
- 性能表现良好
```

### 提交代码更改
```bash
# 添加所有文件到Git
git add .

# 提交更改
git commit -m "feat: 完成项目基础架构搭建

- 实现Express.js后端基础结构
- 创建React前端应用
- 配置前后端开发环境
- 实现API健康检查
- 通过QA质量检查

Story: #1 - 项目基础架构搭建"
```

## 🔄 第七步：创建第二个故事

### 继续工作流程循环
```bash
@sm

第一个故事已经完成，请基于当前进度创建下一个优先级最高的开发故事。

当前完成状态：
- ✅ 项目基础架构搭建完成
- ✅ 前后端通信正常
- ✅ 开发环境配置完成

请分析下一步应该实现什么功能。
```

### 预期的第二个故事
SM可能会创建类似的故事：

```markdown
# Story 2: 用户认证系统

## 故事描述
作为用户，我需要能够注册账户和登录系统，以便安全地管理我的个人待办事项。

## 验收标准
- [ ] 实现用户注册API
- [ ] 实现用户登录API  
- [ ] 实现JWT token认证
- [ ] 创建用户数据模型
- [ ] 实现密码安全存储（bcrypt）
- [ ] 创建登录/注册前端页面
- [ ] 实现前端认证状态管理

## 技术实现指导
- 使用bcrypt进行密码哈希
- 使用jsonwebtoken生成JWT
- 实现认证中间件
- 添加用户会话管理

## 文件清单
- server/models/User.js
- server/routes/auth.js  
- server/middleware/auth.js
- client/src/pages/Login.js
- client/src/pages/Register.js
- client/src/contexts/AuthContext.js
```

## 📊 第八步：开发进度跟踪

### 创建开发看板
在项目中创建简单的进度跟踪：

```bash
# 创建stories目录
mkdir -p docs/stories

# 创建进度跟踪文件
touch docs/stories/progress.md
```

**docs/stories/progress.md**:
```markdown
# TodoMaster 开发进度

## 📊 总体进度
- 故事总数：预计8-10个
- 已完成：1个
- 进行中：1个  
- 待开始：6-8个

## 📝 故事列表

### ✅ 已完成
1. **项目基础架构搭建** - 完成日期: 2024-XX-XX
   - 前后端基础结构
   - 开发环境配置
   - API健康检查

### 🚧 进行中
2. **用户认证系统** - 开始日期: 2024-XX-XX
   - 注册登录功能
   - JWT认证
   - 密码安全

### 📋 待开始
3. 任务CRUD操作
4. 任务分类管理
5. 任务筛选和搜索
6. 用户界面优化
7. 数据持久化
8. 部署配置
```

### 时间记录
每完成一个故事，记录所花费的时间：

```markdown
## ⏱️ 时间统计

### Story 1: 项目基础架构搭建
- SM创建故事：30分钟
- Dev实现功能：2小时
- QA质量检查：45分钟
- 问题修复：30分钟
- **总计**：3小时45分钟

### Story 2: 用户认证系统
- SM创建故事：___ 分钟
- Dev实现功能：___ 小时
- QA质量检查：___ 分钟
- **总计**：___ 小时
```

## 🚨 常见问题处理

### 代理无法理解项目上下文
**问题**：IDE中的代理似乎不了解项目背景
**解决**：
```bash
# 在每次新对话开始时提供上下文
@sm

项目背景：TodoMaster待办事项管理应用
当前状态：已完成基础架构搭建
技术栈：React + Express + SQLite
目标：实现MVP版本

基于docs/目录中的PRD和架构文档，请创建下一个开发故事。
```

### 实现的代码不符合架构设计
**问题**：Developer实现的代码与架构文档不一致
**解决**：
```bash
@dev

你实现的代码需要严格按照docs/architecture/目录中的架构设计。请特别注意：
1. 技术栈选择：必须使用指定的技术
2. 文件结构：按照架构文档的结构组织
3. API设计：遵循docs/architecture/api-specification.md
4. 数据库设计：按照database-design.md实现

请重新实现，确保与架构设计一致。
```

### QA检查过于严格或宽松
**问题**：QA的标准不符合项目需求
**解决**：
```bash
@qa

请按照以下标准进行检查：
检查重点：[根据项目需求调整]
质量标准：[明确具体标准]
安全要求：[根据应用类型调整]

这是一个学习项目，请在保证质量的同时，避免过度复杂的要求。
```

## 🎯 第九步：加速开发循环

### 优化工作流程
随着熟练度提升，可以加速开发：

#### 批量故事创建
```bash
@sm

基于当前进度，请一次性创建接下来的3个开发故事：
1. 任务CRUD操作
2. 任务分类管理  
3. 用户界面基础

每个故事要包含完整的验收标准和技术指导。
```

#### 并行开发
对于独立的功能，可以并行开发：
```bash
# 同时开发前端和后端
@dev 请先实现后端API，我会在另一个会话中处理前端
```

#### 快速QA检查
```bash
@qa 

请进行快速质量检查，重点关注：
1. 核心功能是否工作
2. 是否有明显的bug
3. 代码结构是否合理

这是MVP开发，请避免过于细致的检查。
```

## ✅ 开发阶段完成标志

当你完成以下内容时，开发阶段就算成功：

### 功能完成度
- [ ] 用户认证系统
- [ ] 任务CRUD操作
- [ ] 基本的任务分类
- [ ] 简单的用户界面
- [ ] 数据持久化存储

### 质量保证
- [ ] 所有故事通过QA检查
- [ ] 核心功能测试通过
- [ ] 代码结构清晰
- [ ] 基本的错误处理

### 项目管理
- [ ] 所有故事文档化
- [ ] 开发进度被记录
- [ ] 代码已提交到Git
- [ ] 项目可以正常运行

## ✅ 完成标记

学完本章后，请在主README.md中勾选：
- [ ] 05-开发阶段实践 - 掌握IDE开发流程

## 🚀 下一步

开发阶段完成后，让我们学习BMAD-METHOD的高级特性和扩展功能。

**[点击这里进入 06-高级特性扩展.md →](06-高级特性扩展.md)**

---

*💡 提示：开发阶段是BMAD-METHOD的另一个核心价值体现。通过故事驱动的开发模式，你不仅构建了应用，更重要的是体验了专业的软件开发流程。这种结构化的方法可以应用到你未来的所有项目中。*