# 第二章：项目分析和准备

## 🎯 本章目标

学完本章后，你将：
- 🔍 掌握系统化分析现有项目的方法
- 🛠️ 学会搭建适合Brownfield项目的BMAD环境
- 📊 能够评估项目复杂度和变更风险
- 📋 制定适合的项目改进策略

## 🚀 快速开始检查清单

在深入分析之前，请确保：
- [ ] 已完成基础BMAD-METHOD教程
- [ ] 有一个现有项目可以用于实践
- [ ] 具备该项目的必要权限（查看代码、运行环境等）
- [ ] BMAD-METHOD环境已正确配置

## 📊 第一步：项目初步调研

### 1.1 收集基础信息

#### 项目概况调研表
```markdown
## 项目基础信息
- **项目名称**: ________________
- **业务域**: ________________
- **上线时间**: ________________
- **用户规模**: ________________
- **团队规模**: ________________

## 技术信息
- **主要技术栈**: ________________
- **代码库规模**: ________________
- **部署环境**: ________________
- **数据库**: ________________
- **第三方依赖**: ________________

## 业务信息
- **核心功能**: ________________
- **主要用户群**: ________________
- **关键业务流程**: ________________
- **性能要求**: ________________
```

#### 利益相关者识别
```markdown
## 关键人员
- **产品负责人**: ________________
- **技术负责人**: ________________  
- **主要开发者**: ________________
- **运维负责人**: ________________
- **主要用户代表**: ________________

## 沟通渠道
- **项目文档位置**: ________________
- **代码仓库地址**: ________________
- **沟通群组**: ________________
- **会议节奏**: ________________
```

### 1.2 现有文档审查

#### 文档完整性检查
```bash
# 检查项目文档现状
项目根目录/
├── README.md                 # ✅/❌ 项目说明
├── CHANGELOG.md              # ✅/❌ 变更日志
├── docs/                     # ✅/❌ 文档目录
│   ├── api/                  # ✅/❌ API文档
│   ├── deployment/           # ✅/❌ 部署文档
│   └── architecture/         # ✅/❌ 架构文档
├── tests/                    # ✅/❌ 测试文档
└── scripts/                  # ✅/❌ 脚本文档
```

#### 文档质量评估
- **完整性**: 文档是否覆盖主要功能？
- **准确性**: 文档是否与当前代码一致？
- **可读性**: 文档是否清晰易懂？
- **维护性**: 文档最后更新时间？

## 🔧 第二步：代码库深度分析

### 2.1 使用BMAD代码分析工具

#### 生成代码库概览
```bash
# 进入项目目录
cd /path/to/existing-project

# 生成代码库扁平化文件
npx bmad-method flatten

# 检查生成的文件
ls -la flattened-codebase.xml
```

**输出示例**：
```bash
📊 Completion Summary:
✅ Successfully processed 324 files into flattened-codebase.xml
📁 Output file: /path/to/project/flattened-codebase.xml
📏 Total source size: 12.7 MB
📄 Generated XML size: 11.2 MB
📝 Total lines of code: 45,892
🔢 Estimated tokens: 1,234,567
📊 File breakdown: 298 text, 26 binary, 0 errors
```

#### 分析结果解读
```markdown
## 代码库规模分析
- **小型项目** (< 10万tokens): 简单分析策略
- **中型项目** (10-50万tokens): 分模块分析
- **大型项目** (> 50万tokens): 重点分析核心模块

## 复杂度评估
- **低复杂度**: 单一技术栈，结构清晰
- **中复杂度**: 多技术栈，但架构合理
- **高复杂度**: 技术栈混杂，架构复杂
```

### 2.2 技术栈分析

#### 前端技术栈识别
```bash
# 检查package.json
cat package.json | grep -A 20 '"dependencies"'

# 检查关键文件
find . -name "*.html" -o -name "*.js" -o -name "*.ts" -o -name "*.vue" -o -name "*.react" | head -10
```

**常见技术栈模式**：
```javascript
// 现代React项目
{
  "react": "^18.0.0",
  "typescript": "^4.9.0",
  "vite": "^4.0.0"
}

// 传统jQuery项目  
{
  "jquery": "^1.12.4",
  "bootstrap": "^3.4.1"
}

// Vue.js项目
{
  "vue": "^3.2.0",
  "@vue/cli": "^5.0.0"
}
```

#### 后端技术栈识别
```bash
# Node.js项目
ls package.json

# Python项目
ls requirements.txt setup.py pyproject.toml

# Java项目  
ls pom.xml build.gradle

# PHP项目
ls composer.json

# Go项目
ls go.mod
```

#### 数据库和存储分析
```bash
# 查找数据库配置文件
find . -name "*.env*" -o -name "config.js" -o -name "database.yml" -o -name "settings.py"

# 查找数据库迁移文件
find . -path "*/migrations/*" -o -path "*/migrate/*"

# 查找SQL文件
find . -name "*.sql" | head -10
```

### 2.3 依赖关系分析

#### 依赖复杂度评估
```bash
# Node.js项目依赖分析
npm list --depth=0
npm audit

# Python项目依赖分析  
pip list
pip check

# 检查过时依赖
npx npm-check-updates
# 或者
pip list --outdated
```

#### 关键依赖识别
```markdown
## 依赖风险评估
- **核心依赖**: 影响主要功能的依赖
- **安全风险**: 有已知漏洞的依赖  
- **版本风险**: 过时或即将淘汰的依赖
- **许可证风险**: 许可证不兼容的依赖
```

## 🏗️ 第三步：架构理解

### 3.1 项目结构分析

#### 目录结构映射
```bash
# 生成项目结构图
tree -I 'node_modules|.git|dist|build' -L 3

# 或者使用更详细的分析
find . -type f -name "*.js" -o -name "*.py" -o -name "*.php" | \
  head -20 | \
  xargs wc -l | \
  sort -nr
```

#### 架构模式识别
```markdown
## 常见架构模式识别

### MVC模式
```
project/
├── models/          # 数据模型
├── views/           # 视图层
├── controllers/     # 控制器
```

### 分层架构
```
project/
├── presentation/    # 表现层
├── business/        # 业务层
├── data/           # 数据访问层
```

### 微服务架构
```  
project/
├── user-service/
├── order-service/
├── payment-service/
```
```

### 3.2 数据流分析

#### API端点映射
```bash
# 搜索API路由定义
grep -r "app.get\|app.post\|@app.route\|Route::" . | head -10

# 搜索数据库查询
grep -r "SELECT\|INSERT\|UPDATE\|DELETE" . | head -5
```

#### 业务流程识别
```markdown
## 核心业务流程映射
1. **用户认证流程**
   - 登录 → 验证 → 生成token → 返回用户信息

2. **核心业务流程**  
   - [根据项目特点填写]

3. **数据处理流程**
   - [根据项目特点填写]
```

## ⚙️ 第四步：环境搭建和配置

### 4.1 BMAD环境准备

#### 在现有项目中集成BMAD
```bash
# 进入项目根目录
cd /path/to/existing-project

# 安装BMAD-METHOD
npx bmad-method@stable install

# 验证安装
ls -la .bmad-core/
```

#### 技术偏好配置
```bash
# 编辑技术偏好文件
code .bmad-core/data/technical-preferences.md
```

**Brownfield项目技术偏好模板**:
```markdown
# Brownfield项目技术偏好

## 🎯 项目约束
- **现有技术栈**: [当前使用的技术栈]
- **不可变更部分**: [不能修改的系统组件]
- **兼容性要求**: [必须保持的兼容性]

## 🚀 改进目标
- **性能改进**: [性能优化目标]
- **可维护性**: [代码质量改进目标]
- **安全性**: [安全加固目标]

## ⚖️ 变更策略
- **渐进式改进**: 优先考虑向后兼容
- **风险控制**: 优先保证业务连续性
- **测试优先**: 充分的回归测试
```

### 4.2 开发环境配置

#### 本地开发环境
```bash
# 安装项目依赖
npm install
# 或
pip install -r requirements.txt

# 配置本地数据库
cp .env.example .env
# 编辑数据库连接信息

# 启动开发环境
npm run dev
# 或
python manage.py runserver
```

#### 测试环境验证
```bash
# 运行现有测试
npm test
# 或
pytest

# 检查测试覆盖率
npm run test:coverage
# 或
pytest --cov
```

## 📊 第五步：风险评估

### 5.1 技术风险评估

#### 风险矩阵
| 风险类型 | 概率 | 影响 | 风险等级 | 缓解措施 |
|----------|------|------|----------|----------|
| 依赖冲突 | 中 | 高 | 🟡 中风险 | 版本锁定，渐进升级 |
| 数据迁移 | 低 | 高 | 🟡 中风险 | 备份策略，回滚计划 |
| 性能下降 | 中 | 中 | 🟢 低风险 | 性能监控，基准测试 |
| 功能破坏 | 高 | 高 | 🔴 高风险 | 全面测试，分步发布 |

#### 风险评估工具
```bash
# 安全漏洞扫描
npm audit
# 或
pip-audit

# 代码质量检查
npx eslint .
# 或  
flake8 .

# 依赖分析
npx license-checker
```

### 5.2 业务风险评估

#### 影响分析
```markdown
## 业务连续性评估
- **核心功能**: [识别绝对不能影响的功能]
- **用户影响**: [评估用户体验变化]
- **数据安全**: [数据完整性和安全性]
- **集成影响**: [对其他系统的影响]

## 回滚准备
- **回滚触发条件**: [什么情况下需要回滚]
- **回滚步骤**: [具体的回滚操作]
- **数据恢复**: [数据恢复策略]
- **通知机制**: [如何通知相关人员]
```

## 📋 第六步：制定改进策略

### 6.1 改进优先级矩阵

#### 价值vs复杂度分析
```markdown
         |  低复杂度  |  高复杂度  |
---------|-----------|-----------|
高价值    | 🚀 优先实施 | 📋 计划实施 |
低价值    | 💡 考虑实施 | ❌ 暂不实施 |
```

#### 具体改进建议分类
```markdown
## 🚀 优先实施 (高价值 + 低复杂度)
- [ ] 修复明显的安全漏洞
- [ ] 优化明显的性能瓶颈
- [ ] 添加关键功能的测试覆盖

## 📋 计划实施 (高价值 + 高复杂度)  
- [ ] 核心业务流程重构
- [ ] 数据库架构优化
- [ ] 前端框架升级

## 💡 考虑实施 (低价值 + 低复杂度)
- [ ] 代码风格统一
- [ ] 文档完善
- [ ] 开发工具优化
```

### 6.2 实施路线图

#### 阶段划分策略
```markdown
## 第一阶段：稳定优化 (1-2周)
**目标**: 在不破坏现有功能的前提下进行优化
- 安全漏洞修复
- 性能优化
- 测试覆盖率提升

## 第二阶段：功能增强 (2-4周)
**目标**: 添加新功能，增强用户体验
- 新功能开发
- 用户界面优化
- 业务流程改进

## 第三阶段：架构改进 (4-8周)  
**目标**: 提升系统可维护性和扩展性
- 代码重构
- 架构优化  
- 技术债务清理
```

## 🔍 第七步：验证和确认

### 7.1 分析结果验证

#### 与团队确认
```markdown
## 分析结果确认检查清单
- [ ] 技术栈分析准确性确认
- [ ] 业务流程理解正确性验证
- [ ] 风险评估合理性讨论
- [ ] 改进策略可行性评估
- [ ] 时间和资源估算确认
```

#### 利益相关者评审
```markdown
## 评审会议准备
- **参与者**: 产品负责人、技术负责人、主要开发者
- **材料**: 分析报告、改进建议、实施计划
- **议题**: 优先级确认、资源分配、风险接受度
- **决策**: 最终改进方案确认
```

### 7.2 准备工作确认

#### 技术准备检查
- [ ] BMAD环境配置完成
- [ ] 开发环境可正常运行
- [ ] 测试环境可用
- [ ] 代码分析工具就绪

#### 团队准备检查
- [ ] 团队成员对改进计划达成共识
- [ ] 角色和职责明确
- [ ] 沟通渠道建立
- [ ] 风险应对措施准备

## 📊 项目分析报告模板

### 分析报告结构
```markdown
# [项目名称] Brownfield分析报告

## 1. 项目概况
- 基础信息
- 业务背景
- 技术现状

## 2. 技术分析
- 技术栈评估
- 架构分析
- 依赖关系分析

## 3. 风险评估
- 技术风险矩阵
- 业务风险分析
- 缓解措施建议

## 4. 改进建议
- 优先级矩阵
- 实施路线图
- 资源需求估算

## 5. 下一步行动
- 立即行动项
- 短期计划
- 长期目标
```

## ✅ 完成检查

完成本章学习和实践后，你应该拥有：

### 分析成果
- [ ] 完整的项目分析报告
- [ ] 风险评估矩阵
- [ ] 改进优先级清单
- [ ] 实施路线图

### 环境配置
- [ ] BMAD环境已配置
- [ ] 开发环境可运行
- [ ] 测试环境已验证
- [ ] 分析工具已就绪

### 团队准备
- [ ] 团队共识已达成
- [ ] 职责分工已明确
- [ ] 风险应对已准备
- [ ] 沟通机制已建立

## 🚀 下一步

项目分析和准备工作完成后，我们需要选择合适的BMAD集成策略。

**[点击这里进入下一章：03-BMAD集成策略 →](03-BMAD集成策略.md)**

---

*💡 提示：项目分析是Brownfield项目成功的关键。花在分析上的时间不会浪费，它会在后续开发中为你节省更多时间并避免重大风险。记住：理解现状是改进的前提。*